<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Collabora ë¸Œë¼ìš°ì € ë””ë²„ê¹…</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-info { background: #f0f8ff; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffe6e6; border-left: 4px solid #ff0000; }
        .success { background: #e6ffe6; border-left: 4px solid #00aa00; }
        .warning { background: #fff3cd; border-left: 4px solid #ffaa00; }
        iframe { width: 100%; height: 600px; border: 2px solid #333; margin: 10px 0; }
        .console-output { background: #000; color: #0f0; padding: 10px; font-family: monospace; height: 200px; overflow-y: scroll; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ” Collabora ë¸Œë¼ìš°ì € ë””ë²„ê¹…</h1>
    
    <div class="debug-info">
        <h3>ì‹¤ì‹œê°„ ì§„ë‹¨</h3>
        <p>ì´ í˜ì´ì§€ëŠ” Collabora URL ë¡œë”© ê³¼ì •ì—ì„œ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶”ì í•©ë‹ˆë‹¤.</p>
    </div>

    <button onclick="testCollaboraURL()">Collabora URL í…ŒìŠ¤íŠ¸</button>
    <button onclick="clearConsole()">ì½˜ì†” ì§€ìš°ê¸°</button>
    <button onclick="openInNewTab()">ìƒˆ íƒ­ì—ì„œ ì—´ê¸°</button>

    <div class="debug-info">
        <h3>ğŸ“‹ ì§„ë‹¨ ì½˜ì†”</h3>
        <div id="console" class="console-output">ì§„ë‹¨ ì‹œì‘ ëŒ€ê¸° ì¤‘...\n</div>
    </div>

    <div class="debug-info">
        <h3>ğŸŒ Collabora iframe</h3>
        <iframe id="collabora-frame" src="about:blank"></iframe>
    </div>

    <script>
        const collaboraURL = "http://localhost:9980/browser/0b27e85/cool.html?WOPISrc=http://localhost:3000/api/v1/wopi/files/7&access_token=eyJhbGciOiJIUzI1NiJ9.eyJmaWxlX2lkIjoiNyIsInVzZXJfaWQiOiIxIiwicGVybWlzc2lvbnMiOnsiY2FuX3dyaXRlIjpmYWxzZSwiY2FuX2V4cG9ydCI6dHJ1ZSwiY2FuX3ByaW50Ijp0cnVlfSwiaWF0IjoxNzU0MTY0MjY4LCJleHAiOjE3NTQyNTA2NjgsImlzcyI6ImV4Y2VsLXVuaWZpZWQiLCJhdWQiOiJ3b3BpIn0.CD4H3YIHxzxxFXewhyoSpd2E7NgyrJwiHGhAsqRmEEk";
        
        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const timestamp = new Date().toISOString().split('T')[1].split('.')[0];
            const prefix = type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : type === 'success' ? 'âœ…' : 'â„¹ï¸';
            console.innerHTML += `[${timestamp}] ${prefix} ${message}\n`;
            console.scrollTop = console.scrollHeight;
        }

        function clearConsole() {
            document.getElementById('console').innerHTML = 'ì½˜ì†” ì§€ì›Œì§\n';
        }

        function openInNewTab() {
            log('ìƒˆ íƒ­ì—ì„œ URL ì—´ê¸°: ' + collaboraURL);
            window.open(collaboraURL, '_blank');
        }

        function testCollaboraURL() {
            const iframe = document.getElementById('collabora-frame');
            
            log('ğŸ”§ Collabora URL í…ŒìŠ¤íŠ¸ ì‹œì‘');
            log('URL: ' + collaboraURL);
            
            // iframe ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            iframe.onload = function() {
                log('iframe ë¡œë“œ ì™„ë£Œ', 'success');
                
                // iframe ë‚´ìš© ê²€ì‚¬ ì‹œë„
                setTimeout(() => {
                    try {
                        const doc = iframe.contentDocument || iframe.contentWindow.document;
                        if (doc) {
                            const title = doc.title || 'No title';
                            const bodyContent = doc.body ? doc.body.innerHTML.substring(0, 100) + '...' : 'No body';
                            
                            log('iframe ì œëª©: ' + title);
                            log('iframe ë‚´ìš© (100ì): ' + bodyContent);
                            
                            // resize-detector í™•ì¸
                            if (bodyContent.includes('resize-detector')) {
                                log('âŒ resize-detector ê°ì§€ë¨ - ë¹ˆ ë¬¸ì„œ ìƒíƒœ', 'error');
                            } else if (bodyContent.includes('collabora') || bodyContent.includes('cool')) {
                                log('âœ… Collabora ì½˜í…ì¸  ê°ì§€ë¨', 'success');
                            } else {
                                log('âš ï¸ ì˜ˆìƒì¹˜ ëª»í•œ ì½˜í…ì¸ ', 'warning');
                            }
                        } else {
                            log('iframe ë¬¸ì„œì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŒ (CORS ì œí•œ)', 'warning');
                        }
                    } catch (e) {
                        log('iframe ì½˜í…ì¸  ê²€ì‚¬ ì‹¤íŒ¨: ' + e.message, 'warning');
                    }
                }, 2000);
            };
            
            iframe.onerror = function() {
                log('iframe ë¡œë“œ ì‹¤íŒ¨', 'error');
            };
            
            // ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ëª¨ë‹ˆí„°ë§
            const originalFetch = window.fetch;
            window.fetch = function(...args) {
                log('Fetch ìš”ì²­: ' + args[0]);
                return originalFetch.apply(this, args)
                    .then(response => {
                        log('Fetch ì‘ë‹µ: ' + response.status + ' ' + response.statusText, 
                             response.ok ? 'success' : 'error');
                        return response;
                    })
                    .catch(error => {
                        log('Fetch ì—ëŸ¬: ' + error.message, 'error');
                        throw error;
                    });
            };
            
            // ì—ëŸ¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            window.addEventListener('error', function(e) {
                log('JavaScript ì—ëŸ¬: ' + e.message + ' (ì¤„: ' + e.lineno + ')', 'error');
            });
            
            // URL ë¡œë“œ ì‹œì‘
            log('iframe src ì„¤ì • ì¤‘...');
            iframe.src = collaboraURL;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹œì‘
        window.addEventListener('DOMContentLoaded', function() {
            log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - í…ŒìŠ¤íŠ¸ ì¤€ë¹„ë¨');
            log('Collabora URL ê¸¸ì´: ' + collaboraURL.length + ' ë¬¸ì');
        });
    </script>
</body>
</html>