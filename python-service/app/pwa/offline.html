<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤í”„ë¼ì¸ - Excel Unified</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .offline-container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        }
        
        .offline-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 30px;
            background: #f0f0f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
        }
        
        .offline-title {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #2d3748;
        }
        
        .offline-message {
            font-size: 16px;
            color: #718096;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .offline-features {
            background: #f7fafc;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
        }
        
        .offline-features h3 {
            font-size: 18px;
            margin-bottom: 16px;
            color: #2d3748;
        }
        
        .feature-list {
            list-style: none;
            text-align: left;
        }
        
        .feature-list li {
            padding: 8px 0;
            color: #4a5568;
            display: flex;
            align-items: center;
        }
        
        .feature-list li::before {
            content: 'âœ“';
            color: #48bb78;
            font-weight: bold;
            margin-right: 12px;
        }
        
        .retry-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 32px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .retry-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .connection-status {
            margin-top: 20px;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .status-offline {
            background: #fed7d7;
            color: #c53030;
            border: 1px solid #feb2b2;
        }
        
        .status-online {
            background: #c6f6d5;
            color: #2f855a;
            border: 1px solid #9ae6b4;
        }
        
        .language-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
        }
        
        .language-switcher select {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 8px 12px;
            color: #333;
            font-size: 14px;
        }
        
        @media (max-width: 600px) {
            .offline-container {
                padding: 30px 20px;
                margin: 20px;
            }
            
            .offline-title {
                font-size: 24px;
            }
            
            .language-switcher {
                position: static;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="language-switcher">
        <select id="languageSelect" onchange="changeLanguage()">
            <option value="ko">í•œêµ­ì–´</option>
            <option value="en">English</option>
            <option value="ja">æ—¥æœ¬èª</option>
            <option value="zh">ä¸­æ–‡</option>
        </select>
    </div>
    
    <div class="offline-container">
        <div class="offline-icon">
            ğŸ“±
        </div>
        
        <h1 class="offline-title" id="title">ì˜¤í”„ë¼ì¸ ëª¨ë“œ</h1>
        
        <p class="offline-message" id="message">
            ì¸í„°ë„· ì—°ê²°ì´ ì—†ì–´ë„ ì¼ë¶€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
        
        <div class="offline-features">
            <h3 id="featuresTitle">ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ëŠ¥</h3>
            <ul class="feature-list">
                <li id="feature1">ì´ì „ì— ë¶„ì„í•œ Excel íŒŒì¼ ì¡°íšŒ</li>
                <li id="feature2">ì €ì¥ëœ í…œí”Œë¦¿ ëª©ë¡ í™•ì¸</li>
                <li id="feature3">ì‚¬ìš©ì ì„¤ì • ë° ê¸°ë³¸ ì„¤ì •</li>
                <li id="feature4">ë„ì›€ë§ ë° ê°€ì´ë“œ ë¬¸ì„œ</li>
            </ul>
        </div>
        
        <button class="retry-button" onclick="checkConnection()" id="retryButton">
            ì—°ê²° ë‹¤ì‹œ ì‹œë„
        </button>
        
        <div class="connection-status status-offline" id="connectionStatus">
            ì˜¤í”„ë¼ì¸ ìƒíƒœ
        </div>
    </div>

    <script>
        // ë‹¤êµ­ì–´ ì§€ì›
        const translations = {
            ko: {
                title: 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ',
                message: 'ì¸í„°ë„· ì—°ê²°ì´ ì—†ì–´ë„ ì¼ë¶€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                featuresTitle: 'ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ëŠ¥',
                feature1: 'ì´ì „ì— ë¶„ì„í•œ Excel íŒŒì¼ ì¡°íšŒ',
                feature2: 'ì €ì¥ëœ í…œí”Œë¦¿ ëª©ë¡ í™•ì¸', 
                feature3: 'ì‚¬ìš©ì ì„¤ì • ë° ê¸°ë³¸ ì„¤ì •',
                feature4: 'ë„ì›€ë§ ë° ê°€ì´ë“œ ë¬¸ì„œ',
                retryButton: 'ì—°ê²° ë‹¤ì‹œ ì‹œë„',
                statusOffline: 'ì˜¤í”„ë¼ì¸ ìƒíƒœ',
                statusOnline: 'ì˜¨ë¼ì¸ ì—°ê²°ë¨'
            },
            en: {
                title: 'Offline Mode',
                message: 'Some features are available even without internet connection.',
                featuresTitle: 'Available Features',
                feature1: 'View previously analyzed Excel files',
                feature2: 'Check saved template list',
                feature3: 'User settings and preferences',
                feature4: 'Help and guide documents',
                retryButton: 'Retry Connection',
                statusOffline: 'Offline',
                statusOnline: 'Online'
            },
            ja: {
                title: 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰',
                message: 'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒãªãã¦ã‚‚ä¸€éƒ¨ã®æ©Ÿèƒ½ã‚’ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚',
                featuresTitle: 'åˆ©ç”¨å¯èƒ½ãªæ©Ÿèƒ½',
                feature1: 'ä»¥å‰ã«åˆ†æã—ãŸExcelãƒ•ã‚¡ã‚¤ãƒ«ã®è¡¨ç¤º',
                feature2: 'ä¿å­˜ã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§ã®ç¢ºèª',
                feature3: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã¨åŸºæœ¬è¨­å®š',
                feature4: 'ãƒ˜ãƒ«ãƒ—ã¨ã‚¬ã‚¤ãƒ‰æ–‡æ›¸',
                retryButton: 'æ¥ç¶šã‚’å†è©¦è¡Œ',
                statusOffline: 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³',
                statusOnline: 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³'
            },
            zh: {
                title: 'ç¦»çº¿æ¨¡å¼',
                message: 'å³ä½¿æ²¡æœ‰äº’è”ç½‘è¿æ¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨éƒ¨åˆ†åŠŸèƒ½ã€‚',
                featuresTitle: 'å¯ç”¨åŠŸèƒ½',
                feature1: 'æŸ¥çœ‹ä¹‹å‰åˆ†æçš„Excelæ–‡ä»¶',
                feature2: 'æ£€æŸ¥ä¿å­˜çš„æ¨¡æ¿åˆ—è¡¨',
                feature3: 'ç”¨æˆ·è®¾ç½®å’Œåå¥½',
                feature4: 'å¸®åŠ©å’ŒæŒ‡å—æ–‡æ¡£',
                retryButton: 'é‡è¯•è¿æ¥',
                statusOffline: 'ç¦»çº¿',
                statusOnline: 'åœ¨çº¿'
            }
        };
        
        // ì–¸ì–´ ê°ì§€ ë° ì„¤ì •
        function detectLanguage() {
            const saved = localStorage.getItem('offline-language');
            if (saved && translations[saved]) {
                return saved;
            }
            
            const browserLang = navigator.language.split('-')[0];
            return translations[browserLang] ? browserLang : 'ko';
        }
        
        // ì–¸ì–´ ë³€ê²½
        function changeLanguage() {
            const selectedLang = document.getElementById('languageSelect').value;
            localStorage.setItem('offline-language', selectedLang);
            updateContent(selectedLang);
        }
        
        // ì½˜í…ì¸  ì—…ë°ì´íŠ¸
        function updateContent(lang) {
            const t = translations[lang];
            
            document.getElementById('title').textContent = t.title;
            document.getElementById('message').textContent = t.message;
            document.getElementById('featuresTitle').textContent = t.featuresTitle;
            document.getElementById('feature1').textContent = t.feature1;
            document.getElementById('feature2').textContent = t.feature2;
            document.getElementById('feature3').textContent = t.feature3;
            document.getElementById('feature4').textContent = t.feature4;
            document.getElementById('retryButton').textContent = t.retryButton;
            
            const status = document.getElementById('connectionStatus');
            const isOnline = navigator.onLine;
            status.textContent = isOnline ? t.statusOnline : t.statusOffline;
            status.className = isOnline ? 'connection-status status-online' : 'connection-status status-offline';
        }
        
        // ì—°ê²° ìƒíƒœ í™•ì¸
        function checkConnection() {
            const button = document.getElementById('retryButton');
            const originalText = button.textContent;
            
            button.textContent = 'í™•ì¸ ì¤‘...';
            button.disabled = true;
            
            // ì—°ê²° í…ŒìŠ¤íŠ¸
            fetch('/api/v1/health', { 
                method: 'GET',
                cache: 'no-cache'
            })
            .then(response => {
                if (response.ok) {
                    // ì˜¨ë¼ì¸ ìƒíƒœ - ë©”ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                    window.location.href = '/';
                } else {
                    throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
                }
            })
            .catch(() => {
                // ì—¬ì „íˆ ì˜¤í”„ë¼ì¸
                setTimeout(() => {
                    button.textContent = originalText;
                    button.disabled = false;
                }, 1000);
            });
        }
        
        // ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        window.addEventListener('online', () => {
            const lang = document.getElementById('languageSelect').value;
            updateContent(lang);
            
            // ìë™ìœ¼ë¡œ ë©”ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            setTimeout(() => {
                window.location.href = '/';
            }, 1000);
        });
        
        window.addEventListener('offline', () => {
            const lang = document.getElementById('languageSelect').value;
            updateContent(lang);
        });
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            const currentLang = detectLanguage();
            document.getElementById('languageSelect').value = currentLang;
            updateContent(currentLang);
            
            // ì£¼ê¸°ì ìœ¼ë¡œ ì—°ê²° ìƒíƒœ í™•ì¸
            setInterval(() => {
                const lang = document.getElementById('languageSelect').value;
                updateContent(lang);
            }, 5000);
        });
        
        // ìºì‹œëœ ë°ì´í„° ë¡œë“œ ì‹œë„
        function loadCachedData() {
            try {
                // IndexedDBë‚˜ localStorageì—ì„œ ìºì‹œëœ ë°ì´í„° ë¡œë“œ
                const cachedAnalysis = localStorage.getItem('cached-analysis');
                const cachedTemplates = localStorage.getItem('cached-templates');
                
                if (cachedAnalysis || cachedTemplates) {
                    console.log('ìºì‹œëœ ë°ì´í„° ì‚¬ìš© ê°€ëŠ¥');
                    // ì‚¬ìš© ê°€ëŠ¥í•œ ìºì‹œëœ ê¸°ëŠ¥ë“¤ì„ í‘œì‹œ
                }
            } catch (error) {
                console.log('ìºì‹œëœ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìºì‹œëœ ë°ì´í„° í™•ì¸
        loadCachedData();
    </script>
</body>
</html>